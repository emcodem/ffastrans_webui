(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"0Tfw":function(e,t,n){"use strict";var r=n("q1tI"),a=n.n(r),i=n("kDDq"),o=n("kDLi"),c=function(e){var t=e.currentFormValues,n=e.imageRendererAvailable,r=e.register;return a.a.createElement(o.CollapsableSection,{label:"Notification settings",isOpen:!1},a.a.createElement(o.Field,null,a.a.createElement(o.Checkbox,{name:"isDefault",ref:r,label:"Default",description:"Use this notification for all alerts"})),a.a.createElement(o.Field,null,a.a.createElement(o.Checkbox,{name:"settings.uploadImage",ref:r,label:"Include image",description:"Captures an image and include it in the notification"})),t.uploadImage&&!n&&a.a.createElement(o.InfoBox,{title:"No image renderer available/installed"},"Grafana cannot find an image renderer to capture an image for the notification. Please make sure the Grafana Image Renderer plugin is installed. Please contact your Grafana administrator to install the plugin."),a.a.createElement(o.Field,null,a.a.createElement(o.Checkbox,{name:"disableResolveMessage",ref:r,label:"Disable Resolve Message",description:"Disable the resolve message [OK] that is sent when alerting state returns to false"})),a.a.createElement(o.Field,null,a.a.createElement(o.Checkbox,{name:"sendReminder",ref:r,label:"Send reminders",description:"Send additional notifications for triggered alerts"})),t.sendReminder&&a.a.createElement(a.a.Fragment,null,a.a.createElement(o.Field,{label:"Send reminder every",description:"Specify how often reminders should be sent, e.g. every 30s, 1m, 10m, 30m or 1h etc. Alert reminders are sent after rules are evaluated. Therefore a reminder can never be sent more frequently than a configured alert rule evaluation interval."},a.a.createElement(o.Input,{name:"frequency",ref:r,width:8}))))},u=function(e){var t=e.control,n=e.option,r=e.register,i=e.invalid,c=n.secure?"secureSettings.".concat(n.propertyName):"settings.".concat(n.propertyName);switch(n.element){case"input":return a.a.createElement(o.Input,{invalid:i,type:n.inputType,name:"".concat(c),ref:r({required:!!n.required&&"Required",validate:function(e){return""===n.validationRule||l(e,n.validationRule)}}),placeholder:n.placeholder});case"select":return a.a.createElement(o.InputControl,{as:o.Select,options:n.selectOptions,control:t,name:"".concat(c),invalid:i});case"textarea":return a.a.createElement(o.TextArea,{invalid:i,name:"".concat(c),ref:r({required:!!n.required&&"Required",validate:function(e){return""===n.validationRule||l(e,n.validationRule)}})});default:return console.error("Element not supported",n.element),null}},l=function(e,t){return!!RegExp(t).test(e)||"Invalid format"},s=function(e){var t=e.control,n=e.currentFormValues,r=e.errors,i=e.selectedChannelOptions,c=e.register,l=e.onResetSecureField,s=e.secureFields;return a.a.createElement(a.a.Fragment,null,i.map((function(e,i){var f,d="".concat(e.label,"-").concat(i),p=n["settings.".concat(e.showWhen.field)]&&n["settings.".concat(e.showWhen.field)].value;return e.showWhen.field&&p!==e.showWhen.is?null:"checkbox"===e.element?a.a.createElement(o.Field,{key:d},a.a.createElement(o.Checkbox,{name:e.secure?"secureSettings.".concat(e.propertyName):"settings.".concat(e.propertyName),ref:c,label:e.label,description:e.description})):a.a.createElement(o.Field,{key:d,label:e.label,description:e.description,invalid:r.settings&&!!r.settings[e.propertyName],error:r.settings&&(null===(f=r.settings[e.propertyName])||void 0===f?void 0:f.message)},s&&s[e.propertyName]?a.a.createElement(o.Input,{readOnly:!0,value:"Configured",suffix:a.a.createElement(o.Button,{onClick:function(){return l(e.propertyName)},variant:"link",type:"button",size:"sm"},"Clear")}):a.a.createElement(u,{option:e,register:c,control:t}))})))},f=function(e){var t=e.control,n=e.currentFormValues,r=e.errors,i=e.secureFields,c=e.selectedChannel,u=e.channels,l=e.register,f=e.resetSecureField;return a.a.createElement(a.a.Fragment,null,a.a.createElement(o.Field,{label:"Name",invalid:!!r.name,error:r.name&&r.name.message},a.a.createElement(o.Input,{name:"name",ref:l({required:"Name is required"})})),a.a.createElement(o.Field,{label:"Type"},a.a.createElement(o.InputControl,{name:"type",as:o.Select,options:u,control:t,rules:{required:!0}})),a.a.createElement(s,{selectedChannelOptions:c.options.filter((function(e){return e.required})),currentFormValues:n,secureFields:i,onResetSecureField:f,register:l,errors:r,control:t}))},d=function(e){var t=e.control,n=e.currentFormValues,r=e.errors,i=e.selectedChannel,c=e.secureFields,u=e.register,l=e.resetSecureField;return a.a.createElement(o.CollapsableSection,{label:"Optional ".concat(i.heading),isOpen:!1},""!==i.info&&a.a.createElement(o.InfoBox,null,i.info),a.a.createElement(s,{selectedChannelOptions:i.options.filter((function(e){return!e.required})),currentFormValues:n,register:u,errors:r,control:t,onResetSecureField:l,secureFields:c}))},p=n("ZFWI");function m(){var e=b(["\n      padding-top: ",";\n    "]);return m=function(){return e},e}function v(){var e=b(["\n      flex-grow: 1;\n      padding-top: ",";\n    "]);return v=function(){return e},e}function g(){var e=b([""]);return g=function(){return e},e}function b(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function h(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(t,"a",(function(){return y}));var y=function(e){var t=e.control,n=e.errors,i=e.selectedChannel,u=e.selectableChannels,l=e.register,s=e.watch,m=e.getValues,v=e.imageRendererAvailable,g=e.onTestChannel,b=e.resetSecureField,y=e.secureFields,j=O(Object(o.useTheme)()),w=new Set(null==i?void 0:i.options.filter((function(e){return e.showWhen.field})).map((function(e){return"settings.".concat(e.showWhen.field)})))||[];Object(r.useEffect)((function(){s(["type","sendReminder","uploadImage"].concat(h(w)))}),[w]);var E=m();return i?a.a.createElement("div",{className:j.formContainer},a.a.createElement("div",{className:j.formItem},a.a.createElement(f,{selectedChannel:i,channels:u,secureFields:y,resetSecureField:b,currentFormValues:E,register:l,errors:n,control:t})),i.options.filter((function(e){return!e.required})).length>0&&a.a.createElement("div",{className:j.formItem},a.a.createElement(d,{selectedChannel:i,secureFields:y,resetSecureField:b,currentFormValues:E,register:l,errors:n,control:t})),a.a.createElement("div",{className:j.formItem},a.a.createElement(c,{imageRendererAvailable:v,currentFormValues:E,register:l,errors:n,control:t})),a.a.createElement("div",{className:j.formButtons},a.a.createElement(o.HorizontalGroup,null,a.a.createElement(o.Button,{type:"submit"},"Save"),a.a.createElement(o.Button,{type:"button",variant:"secondary",onClick:function(){return g(m({nest:!0}))}},"Test"),a.a.createElement("a",{href:"".concat(p.b.appSubUrl,"/alerting/notifications")},a.a.createElement(o.Button,{type:"button",variant:"secondary"},"Back"))))):a.a.createElement(o.Spinner,null)},O=Object(o.stylesFactory)((function(e){return{formContainer:Object(i.css)(g()),formItem:Object(i.css)(v(),e.spacing.md),formButtons:Object(i.css)(m(),e.spacing.xl)}}))},"4vLh":function(e,t,n){"use strict";n.d(t,"c",(function(){return v})),n.d(t,"i",(function(){return g})),n.d(t,"b",(function(){return b})),n.d(t,"l",(function(){return h})),n.d(t,"h",(function(){return y})),n.d(t,"e",(function(){return O})),n.d(t,"d",(function(){return j})),n.d(t,"a",(function(){return w})),n.d(t,"k",(function(){return E})),n.d(t,"j",(function(){return S})),n.d(t,"g",(function(){return x})),n.d(t,"f",(function(){return R}));var r=n("Obii"),a=n("t8hP"),i=n("HJRA"),o=n("3SGO"),c=n("SMGL"),u=n("qOGI"),l=n("exx3");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t,n,r,a,i,o){try{var c=e[i](o),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){p(i,r,a,o,c,"next",e)}function c(e){p(i,r,a,o,c,"throw",e)}o(void 0)}))}}function v(e){return function(){var t=m(regeneratorRuntime.mark((function t(n){var r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(Object(u.c)()),t.next=3,Object(a.getBackendSrv)().get("/api/alerts",e);case 3:if(r=t.sent,!a.config.featureToggles.ngalert){t.next=9;break}return t.next=7,Object(a.getBackendSrv)().get("/api/alert-definitions");case 7:i=t.sent,n(Object(u.g)(i.results));case 9:n(Object(u.d)(r));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}function g(e,t){return function(){var n=m(regeneratorRuntime.mark((function n(r,i){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(a.getBackendSrv)().post("/api/alerts/".concat(e,"/pause"),t);case 2:o=i().location.query.state||"all",r(v({state:o.toString()}));case 4:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}function b(e){return function(){var t=m(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(a.getBackendSrv)().post("/api/alert-notifications",e);case 3:i.a.emit(r.AppEvents.alertSuccess,["Notification created"]),n(Object(o.d)({path:"alerting/notifications"})),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i.a.emit(r.AppEvents.alertError,[t.t0.data.error]);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}()}function h(e){return function(){var t=m(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(a.getBackendSrv)().put("/api/alert-notifications/".concat(e.id),e);case 3:i.a.emit(r.AppEvents.alertSuccess,["Notification updated"]),n(Object(o.d)({path:"alerting/notifications"})),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i.a.emit(r.AppEvents.alertError,[t.t0.data.error]);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}()}function y(e){return function(){var t=m(regeneratorRuntime.mark((function t(n,r){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=r().notificationChannel.notificationChannel,t.next=3,Object(a.getBackendSrv)().post("/api/alert-notifications/test",f({id:i.id},e));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}function O(){return function(){var e=m(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(a.getBackendSrv)().get("/api/alert-notifiers");case 2:n=e.sent,r=n.sort((function(e,t){return e.name>t.name?1:-1})),t(Object(u.h)(r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}function j(e){return function(){var t=m(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(O());case 2:return t.next=4,Object(a.getBackendSrv)().get("/api/alert-notifications/".concat(e));case 4:r=t.sent,n(Object(u.e)(r));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}function w(){return function(){var e=m(regeneratorRuntime.mark((function e(t,n){var c,u,s,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n().alertDefinition.queryOptions,u=n().alertDefinition.alertDefinition,e.next=4,Object(a.getDataSourceSrv)().get(null);case 4:return s=e.sent,d=f({},u,{condition:{refId:u.condition.refId,queriesAndExpressions:c.queries.map((function(e){var t,n=e.datasource===l.a;if(n)t={name:l.a,uid:l.a};else{var r,i,o=Object(a.getDataSourceSrv)().getInstanceSettings(e.datasource);t={name:null!==(r=null==o?void 0:o.name)&&void 0!==r?r:s.name,uid:null!==(i=null==o?void 0:o.uid)&&void 0!==i?i:s.uid}}return{model:f({},e,{type:n?e.type:e.queryType,datasource:t.name,datasourceUid:t.uid}),refId:e.refId,relativeTimeRange:{From:500,To:0}}}))}}),e.next=8,Object(a.getBackendSrv)().post("/api/alert-definitions",d);case 8:i.a.emit(r.AppEvents.alertSuccess,["Alert definition created"]),t(Object(o.d)({path:"alerting/list"}));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}function E(e){return function(t,n){var r=f({},n().alertDefinition.uiState,{},e);t(Object(u.k)(r));try{c.a.setObject(u.a,r)}catch(e){console.error(e)}}}function S(e){return function(t){t(Object(u.l)(e))}}function x(e){return function(t){t(Object(u.i)(e))}}function R(){return function(e,t){var n,a=t().alertDefinition,i=a.queryRunner,o=a.queryOptions,c={from:"now-1h",to:"now"};i.run({timezone:"browser",timeRange:{from:r.dateMath.parse(c.from),to:r.dateMath.parse(c.to),raw:c},maxDataPoints:null!==(n=o.maxDataPoints)&&void 0!==n?n:100,minInterval:o.minInterval,queries:o.queries,datasource:o.dataSource.name})}}},gKHt:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return f}));var r=n("Wwog");function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var u={id:-1,name:"",type:{value:"email",label:"Email"},sendReminder:!1,disableResolveMessage:!1,frequency:"15m",settings:{uploadImage:n("t8hP").config.rendererAvailable,autoResolve:!0,httpMethod:"POST",severity:"critical"},secureSettings:{},secureFields:{},isDefault:!1},l=Object(r.a)((function(e,t){return e.map((function(e){return t?{value:e.value,label:e.label,description:e.description}:{value:e.value,label:e.label}}))})),s=function(e){var t=Object.fromEntries(Object.entries(e.settings).map((function(e){var t=c(e,2),n=t[0],r=t[1];return[n,r&&r.hasOwnProperty("value")?r.value:r]})));return i({},u,{},e,{frequency:""===e.frequency?u.frequency:e.frequency,type:e.type.value,settings:i({},u.settings,{},t),secureSettings:i({},e.secureSettings)})},f=function(e){var t;return{name:e.name,type:e.type.value,frequency:null!==(t=e.frequency)&&void 0!==t?t:u.frequency,settings:i({},Object.assign(u.settings,e.settings)),secureSettings:i({},e.secureSettings)}}}}]);
//# sourceMappingURL=default~EditNotificationChannel~NewNotificationChannel.63a9c1d648180e457252.js.map