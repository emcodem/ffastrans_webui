{"version":3,"names":["getPath","partialTree","id","cache","sId","file","find","f","type","meAndParentPath","parentId","getCheckedFilesWithPaths","Object","create","checkedFiles","filter","item","status","companionFilesWithInjectedPaths","map","absFolders","firstCheckedFolderIndex","findIndex","i","relFolders","slice","absDirPath","data","name","join","relDirPath","length","undefined"],"sources":["getCheckedFilesWithPaths.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport type {\n  PartialTree,\n  PartialTreeFile,\n  PartialTreeFolderNode,\n  PartialTreeId,\n} from '@uppy/core/lib/Uppy.js'\nimport type { CompanionFile } from '@uppy/utils/lib/CompanionFile'\n\nexport interface Cache {\n  [key: string]: (PartialTreeFile | PartialTreeFolderNode)[]\n}\n\nconst getPath = (\n  partialTree: PartialTree,\n  id: PartialTreeId,\n  cache: Cache,\n): (PartialTreeFile | PartialTreeFolderNode)[] => {\n  const sId = id === null ? 'null' : id\n  if (cache[sId]) return cache[sId]\n\n  const file = partialTree.find((f) => f.id === id)!\n\n  if (file.type === 'root') return []\n\n  const meAndParentPath = [...getPath(partialTree, file.parentId, cache), file]\n  cache[sId] = meAndParentPath\n  return meAndParentPath\n}\n\n// See \"Uppy file properties\" documentation for `.absolutePath` and `.relativePath`\n// (https://uppy.io/docs/uppy/#working-with-uppy-files)\nconst getCheckedFilesWithPaths = (\n  partialTree: PartialTree,\n): CompanionFile[] => {\n  // Equivalent to `const cache = {}`, but makes keys such as 'hasOwnProperty' safe too\n  const cache: Cache = Object.create(null)\n\n  // We're only interested in injecting paths into 'checked' files\n  const checkedFiles = partialTree.filter(\n    (item) => item.type === 'file' && item.status === 'checked',\n  ) as PartialTreeFile[]\n\n  const companionFilesWithInjectedPaths = checkedFiles.map((file) => {\n    const absFolders: (PartialTreeFile | PartialTreeFolderNode)[] = getPath(\n      partialTree,\n      file.id,\n      cache,\n    )\n\n    const firstCheckedFolderIndex = absFolders.findIndex(\n      (i) => i.type === 'folder' && i.status === 'checked',\n    )\n    const relFolders = absFolders.slice(firstCheckedFolderIndex)\n\n    const absDirPath = `/${absFolders.map((i) => i.data.name).join('/')}`\n    const relDirPath =\n      relFolders.length === 1 ?\n        // Must return `undefined` (which later turns into `null` in `.getTagFile()`)\n        // (https://github.com/transloadit/uppy/pull/4537#issuecomment-1629136652)\n        undefined\n      : relFolders.map((i) => i.data.name).join('/')\n\n    return {\n      ...file.data,\n      absDirPath,\n      relDirPath,\n    }\n  })\n\n  return companionFilesWithInjectedPaths\n}\n\nexport default getCheckedFilesWithPaths\n"],"mappings":"AAAA;;AAaA,MAAMA,OAAO,GAAGA,CACdC,WAAwB,EACxBC,EAAiB,EACjBC,KAAY,KACoC;EAChD,MAAMC,GAAG,GAAGF,EAAE,KAAK,IAAI,GAAG,MAAM,GAAGA,EAAE;EACrC,IAAIC,KAAK,CAACC,GAAG,CAAC,EAAE,OAAOD,KAAK,CAACC,GAAG,CAAC;EAEjC,MAAMC,IAAI,GAAGJ,WAAW,CAACK,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACL,EAAE,KAAKA,EAAE,CAAE;EAElD,IAAIG,IAAI,CAACG,IAAI,KAAK,MAAM,EAAE,OAAO,EAAE;EAEnC,MAAMC,eAAe,GAAG,CAAC,GAAGT,OAAO,CAACC,WAAW,EAAEI,IAAI,CAACK,QAAQ,EAAEP,KAAK,CAAC,EAAEE,IAAI,CAAC;EAC7EF,KAAK,CAACC,GAAG,CAAC,GAAGK,eAAe;EAC5B,OAAOA,eAAe;AACxB,CAAC;;AAED;AACA;AACA,MAAME,wBAAwB,GAC5BV,WAAwB,IACJ;EACpB;EACA,MAAME,KAAY,GAAGS,MAAM,CAACC,MAAM,CAAC,IAAI,CAAC;;EAExC;EACA,MAAMC,YAAY,GAAGb,WAAW,CAACc,MAAM,CACpCC,IAAI,IAAKA,IAAI,CAACR,IAAI,KAAK,MAAM,IAAIQ,IAAI,CAACC,MAAM,KAAK,SACpD,CAAsB;EAEtB,MAAMC,+BAA+B,GAAGJ,YAAY,CAACK,GAAG,CAAEd,IAAI,IAAK;IACjE,MAAMe,UAAuD,GAAGpB,OAAO,CACrEC,WAAW,EACXI,IAAI,CAACH,EAAE,EACPC,KACF,CAAC;IAED,MAAMkB,uBAAuB,GAAGD,UAAU,CAACE,SAAS,CACjDC,CAAC,IAAKA,CAAC,CAACf,IAAI,KAAK,QAAQ,IAAIe,CAAC,CAACN,MAAM,KAAK,SAC7C,CAAC;IACD,MAAMO,UAAU,GAAGJ,UAAU,CAACK,KAAK,CAACJ,uBAAuB,CAAC;IAE5D,MAAMK,UAAU,GAAG,IAAIN,UAAU,CAACD,GAAG,CAAEI,CAAC,IAAKA,CAAC,CAACI,IAAI,CAACC,IAAI,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC,EAAE;IACrE,MAAMC,UAAU,GACdN,UAAU,CAACO,MAAM,KAAK,CAAC;IACrB;IACA;IACAC,SAAS,GACTR,UAAU,CAACL,GAAG,CAAEI,CAAC,IAAKA,CAAC,CAACI,IAAI,CAACC,IAAI,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;IAEhD,OAAO;MACL,GAAGxB,IAAI,CAACsB,IAAI;MACZD,UAAU;MACVI;IACF,CAAC;EACH,CAAC,CAAC;EAEF,OAAOZ,+BAA+B;AACxC,CAAC;AAED,eAAeP,wBAAwB","ignoreList":[]}