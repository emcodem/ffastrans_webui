{"version":3,"names":["h","classNames","remoteFileObjToLocal","AuthView","Header","Browser","packageJson","PartialTreeUtils","shouldHandleScroll","handleError","getClickedRange","SearchInput","FooterActions","addFiles","getCheckedFilesWithPaths","getBreadcrumbs","defaultPickerIcon","focusable","width","height","viewBox","d","getDefaultState","rootFolderId","authenticated","undefined","partialTree","type","id","cached","nextPagePath","currentFolderId","searchString","didFirstRender","username","loading","_abortController","_classPrivateFieldLooseKey","_withAbort","ProviderView","constructor","plugin","opts","Object","defineProperty","value","_withAbort2","isHandlingScroll","lastCheckbox","writable","validateSingleFile","file","companionFile","result","uppy","getDisplayedPartialTree","getPluginState","inThisFolder","filter","item","parentId","filtered","_item$data$name","data","name","i18n","toLowerCase","indexOf","validateAggregateRestrictions","checkedFiles","status","uppyFiles","map","provider","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","loadAllFiles","virtualList","openFolder","bind","logout","handleAuth","handleScroll","resetPluginState","donePicking","render","cancelSelection","toggleCheckbox","on","registerRequestClient","setPluginState","tearDown","setLoading","newPartialTree","folderId","clickedFolder","find","folder","_classPrivateFieldLooseBase","signal","currentPagePath","currentItems","items","list","concat","numFiles","length","afterOpenFolder","catch","res","ok","revoked","message","title","url","manual_revoke_url","info","authFormData","login","Promise","all","fetchPreAuthToken","event","currentFolder","i","afterScrollFolder","enrichedTree","afterFill","path","n","aggregateRestrictionError","companionFiles","ourItem","isShiftKeyPressed","clickedRange","afterToggleCheckbox","state","viewOptions","pluginIcon","icon","pluginName","i18nArray","renderForm","renderAuthForm","breadcrumbs","className","setSearchString","s","submitSearchString","inputLabel","clearSearchLabel","wrapperClassName","inputClassName","displayedPartialTree","noResultsLabel","isLoading","op","_classPrivateFieldLoo","abort","abortController","AbortController","cancelRequest","off","VERSION","version"],"sources":["ProviderView.tsx"],"sourcesContent":["import { h } from 'preact'\nimport type {\n  UnknownProviderPlugin,\n  PartialTreeFolder,\n  PartialTreeFolderNode,\n  PartialTreeFile,\n  UnknownProviderPluginState,\n  PartialTreeId,\n  PartialTree,\n} from '@uppy/core/lib/Uppy.js'\nimport type { Body, Meta } from '@uppy/utils/lib/UppyFile'\nimport type { CompanionFile } from '@uppy/utils/lib/CompanionFile'\nimport type Translator from '@uppy/utils/lib/Translator'\nimport classNames from 'classnames'\nimport type { ValidateableFile } from '@uppy/core/lib/Restricter.js'\nimport remoteFileObjToLocal from '@uppy/utils/lib/remoteFileObjToLocal'\nimport AuthView from './AuthView.tsx'\nimport Header from './Header.tsx'\nimport Browser from '../Browser.tsx'\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport packageJson from '../../package.json'\nimport PartialTreeUtils from '../utils/PartialTreeUtils/index.ts'\nimport shouldHandleScroll from '../utils/shouldHandleScroll.ts'\nimport handleError from '../utils/handleError.ts'\nimport getClickedRange from '../utils/getClickedRange.ts'\nimport SearchInput from '../SearchInput.tsx'\nimport FooterActions from '../FooterActions.tsx'\nimport addFiles from '../utils/addFiles.ts'\nimport getCheckedFilesWithPaths from '../utils/PartialTreeUtils/getCheckedFilesWithPaths.ts'\nimport getBreadcrumbs from '../utils/PartialTreeUtils/getBreadcrumbs.ts'\n\nexport function defaultPickerIcon(): h.JSX.Element {\n  return (\n    <svg\n      aria-hidden=\"true\"\n      focusable=\"false\"\n      width=\"30\"\n      height=\"30\"\n      viewBox=\"0 0 30 30\"\n    >\n      <path d=\"M15 30c8.284 0 15-6.716 15-15 0-8.284-6.716-15-15-15C6.716 0 0 6.716 0 15c0 8.284 6.716 15 15 15zm4.258-12.676v6.846h-8.426v-6.846H5.204l9.82-12.364 9.82 12.364H19.26z\" />\n    </svg>\n  )\n}\n\nconst getDefaultState = (\n  rootFolderId: string | null,\n): UnknownProviderPluginState => ({\n  authenticated: undefined, // we don't know yet\n  partialTree: [\n    {\n      type: 'root',\n      id: rootFolderId,\n      cached: false,\n      nextPagePath: null,\n    },\n  ],\n  currentFolderId: rootFolderId,\n  searchString: '',\n  didFirstRender: false,\n  username: null,\n  loading: false,\n})\n\ntype Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>\n\nexport interface Opts<M extends Meta, B extends Body> {\n  provider: UnknownProviderPlugin<M, B>['provider']\n  viewType: 'list' | 'grid'\n  showTitles: boolean\n  showFilter: boolean\n  showBreadcrumbs: boolean\n  loadAllFiles: boolean\n  renderAuthForm?: (args: {\n    pluginName: string\n    i18n: Translator['translateArray']\n    loading: boolean | string\n    onAuth: (authFormData: unknown) => Promise<void>\n  }) => h.JSX.Element\n  virtualList: boolean\n}\ntype PassedOpts<M extends Meta, B extends Body> = Optional<\n  Opts<M, B>,\n  | 'viewType'\n  | 'showTitles'\n  | 'showFilter'\n  | 'showBreadcrumbs'\n  | 'loadAllFiles'\n  | 'virtualList'\n>\ntype DefaultOpts<M extends Meta, B extends Body> = Omit<Opts<M, B>, 'provider'>\ntype RenderOpts<M extends Meta, B extends Body> = Omit<\n  PassedOpts<M, B>,\n  'provider'\n>\n\n/**\n * Class to easily generate generic views for Provider plugins\n */\nexport default class ProviderView<M extends Meta, B extends Body> {\n  static VERSION = packageJson.version\n\n  plugin: UnknownProviderPlugin<M, B>\n\n  provider: UnknownProviderPlugin<M, B>['provider']\n\n  opts: Opts<M, B>\n\n  isHandlingScroll: boolean = false\n\n  lastCheckbox: string | null = null\n\n  constructor(plugin: UnknownProviderPlugin<M, B>, opts: PassedOpts<M, B>) {\n    this.plugin = plugin\n    this.provider = opts.provider\n\n    const defaultOptions: DefaultOpts<M, B> = {\n      viewType: 'list',\n      showTitles: true,\n      showFilter: true,\n      showBreadcrumbs: true,\n      loadAllFiles: false,\n      virtualList: false,\n    }\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.openFolder = this.openFolder.bind(this)\n    this.logout = this.logout.bind(this)\n    this.handleAuth = this.handleAuth.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.resetPluginState = this.resetPluginState.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n    this.render = this.render.bind(this)\n    this.cancelSelection = this.cancelSelection.bind(this)\n    this.toggleCheckbox = this.toggleCheckbox.bind(this)\n\n    // Set default state for the plugin\n    this.resetPluginState()\n\n    // todo\n    // @ts-expect-error this should be typed in @uppy/dashboard.\n    this.plugin.uppy.on('dashboard:close-panel', this.resetPluginState)\n\n    this.plugin.uppy.registerRequestClient(\n      this.provider.provider,\n      this.provider,\n    )\n  }\n\n  resetPluginState(): void {\n    this.plugin.setPluginState(getDefaultState(this.plugin.rootFolderId))\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  tearDown(): void {\n    // Nothing.\n  }\n\n  setLoading(loading: boolean | string): void {\n    this.plugin.setPluginState({ loading })\n  }\n\n  cancelSelection(): void {\n    const { partialTree } = this.plugin.getPluginState()\n    const newPartialTree: PartialTree = partialTree.map((item) =>\n      item.type === 'root' ? item : { ...item, status: 'unchecked' },\n    )\n    this.plugin.setPluginState({ partialTree: newPartialTree })\n  }\n\n  #abortController: AbortController | undefined\n\n  async #withAbort(op: (signal: AbortSignal) => Promise<void>) {\n    // prevent multiple requests in parallel from causing race conditions\n    this.#abortController?.abort()\n    const abortController = new AbortController()\n    this.#abortController = abortController\n    const cancelRequest = () => {\n      abortController.abort()\n    }\n    try {\n      // @ts-expect-error this should be typed in @uppy/dashboard.\n      // Even then I don't think we can make this work without adding dashboard\n      // as a dependency to provider-views.\n      this.plugin.uppy.on('dashboard:close-panel', cancelRequest)\n      this.plugin.uppy.on('cancel-all', cancelRequest)\n\n      await op(abortController.signal)\n    } finally {\n      // @ts-expect-error this should be typed in @uppy/dashboard.\n      // Even then I don't think we can make this work without adding dashboard\n      // as a dependency to provider-views.\n      this.plugin.uppy.off('dashboard:close-panel', cancelRequest)\n      this.plugin.uppy.off('cancel-all', cancelRequest)\n      this.#abortController = undefined\n    }\n  }\n\n  async openFolder(folderId: string | null): Promise<void> {\n    this.lastCheckbox = null\n    // Returning cached folder\n    const { partialTree } = this.plugin.getPluginState()\n    const clickedFolder = partialTree.find(\n      (folder) => folder.id === folderId,\n    )! as PartialTreeFolder\n    if (clickedFolder.cached) {\n      this.plugin.setPluginState({\n        currentFolderId: folderId,\n        searchString: '',\n      })\n      return\n    }\n\n    this.setLoading(true)\n    await this.#withAbort(async (signal) => {\n      let currentPagePath = folderId\n      let currentItems: CompanionFile[] = []\n      do {\n        const { username, nextPagePath, items } = await this.provider.list(\n          currentPagePath,\n          { signal },\n        )\n        // It's important to set the username during one of our first fetches\n        this.plugin.setPluginState({ username })\n\n        currentPagePath = nextPagePath\n        currentItems = currentItems.concat(items)\n        this.setLoading(\n          this.plugin.uppy.i18n('loadedXFiles', {\n            numFiles: currentItems.length,\n          }),\n        )\n      } while (this.opts.loadAllFiles && currentPagePath)\n\n      const newPartialTree = PartialTreeUtils.afterOpenFolder(\n        partialTree,\n        currentItems,\n        clickedFolder,\n        currentPagePath,\n        this.validateSingleFile,\n      )\n\n      this.plugin.setPluginState({\n        partialTree: newPartialTree,\n        currentFolderId: folderId,\n        searchString: '',\n      })\n    }).catch(handleError(this.plugin.uppy))\n\n    this.setLoading(false)\n  }\n\n  /**\n   * Removes session token on client side.\n   */\n  async logout(): Promise<void> {\n    await this.#withAbort(async (signal) => {\n      const res = await this.provider.logout<{\n        ok: boolean\n        revoked: boolean\n        manual_revoke_url: string\n      }>({\n        signal,\n      })\n      // res.ok is from the JSON body, not to be confused with Response.ok\n      if (res.ok) {\n        if (!res.revoked) {\n          const message = this.plugin.uppy.i18n('companionUnauthorizeHint', {\n            provider: this.plugin.title,\n            url: res.manual_revoke_url,\n          })\n          this.plugin.uppy.info(message, 'info', 7000)\n        }\n\n        this.plugin.setPluginState({\n          ...getDefaultState(this.plugin.rootFolderId),\n          authenticated: false,\n        })\n      }\n    }).catch(handleError(this.plugin.uppy))\n  }\n\n  async handleAuth(authFormData?: unknown): Promise<void> {\n    await this.#withAbort(async (signal) => {\n      this.setLoading(true)\n      await this.provider.login({ authFormData, signal })\n      this.plugin.setPluginState({ authenticated: true })\n      await Promise.all([\n        this.provider.fetchPreAuthToken(),\n        this.openFolder(this.plugin.rootFolderId),\n      ])\n    }).catch(handleError(this.plugin.uppy))\n    this.setLoading(false)\n  }\n\n  async handleScroll(event: Event): Promise<void> {\n    const { partialTree, currentFolderId } = this.plugin.getPluginState()\n    const currentFolder = partialTree.find(\n      (i) => i.id === currentFolderId,\n    ) as PartialTreeFolder\n    if (\n      shouldHandleScroll(event) &&\n      !this.isHandlingScroll &&\n      currentFolder.nextPagePath\n    ) {\n      this.isHandlingScroll = true\n      await this.#withAbort(async (signal) => {\n        const { nextPagePath, items } = await this.provider.list(\n          currentFolder.nextPagePath,\n          { signal },\n        )\n        const newPartialTree = PartialTreeUtils.afterScrollFolder(\n          partialTree,\n          currentFolderId,\n          items,\n          nextPagePath,\n          this.validateSingleFile,\n        )\n\n        this.plugin.setPluginState({ partialTree: newPartialTree })\n      }).catch(handleError(this.plugin.uppy))\n      this.isHandlingScroll = false\n    }\n  }\n\n  validateSingleFile = (file: CompanionFile): string | null => {\n    const companionFile: ValidateableFile<M, B> = remoteFileObjToLocal(file)\n    const result = this.plugin.uppy.validateSingleFile(companionFile)\n    return result\n  }\n\n  async donePicking(): Promise<void> {\n    const { partialTree } = this.plugin.getPluginState()\n\n    this.setLoading(true)\n    await this.#withAbort(async (signal) => {\n      // 1. Enrich our partialTree by fetching all 'checked' but not-yet-fetched folders\n      const enrichedTree: PartialTree = await PartialTreeUtils.afterFill(\n        partialTree,\n        (path: PartialTreeId) => this.provider.list(path, { signal }),\n        this.validateSingleFile,\n        (n) => {\n          this.setLoading(\n            this.plugin.uppy.i18n('addedNumFiles', { numFiles: n }),\n          )\n        },\n      )\n\n      // 2. Now that we know how many files there are - recheck aggregateRestrictions!\n      const aggregateRestrictionError =\n        this.validateAggregateRestrictions(enrichedTree)\n      if (aggregateRestrictionError) {\n        this.plugin.setPluginState({ partialTree: enrichedTree })\n        return\n      }\n\n      // 3. Add files\n      const companionFiles = getCheckedFilesWithPaths(enrichedTree)\n      addFiles(companionFiles, this.plugin, this.provider)\n\n      // 4. Reset state\n      this.resetPluginState()\n    }).catch(handleError(this.plugin.uppy))\n    this.setLoading(false)\n  }\n\n  toggleCheckbox(\n    ourItem: PartialTreeFolderNode | PartialTreeFile,\n    isShiftKeyPressed: boolean,\n  ) {\n    const { partialTree } = this.plugin.getPluginState()\n\n    const clickedRange = getClickedRange(\n      ourItem.id,\n      this.getDisplayedPartialTree(),\n      isShiftKeyPressed,\n      this.lastCheckbox,\n    )\n    const newPartialTree = PartialTreeUtils.afterToggleCheckbox(\n      partialTree,\n      clickedRange,\n    )\n\n    this.plugin.setPluginState({ partialTree: newPartialTree })\n    this.lastCheckbox = ourItem.id\n  }\n\n  getDisplayedPartialTree = (): (PartialTreeFile | PartialTreeFolderNode)[] => {\n    const { partialTree, currentFolderId, searchString } =\n      this.plugin.getPluginState()\n    const inThisFolder = partialTree.filter(\n      (item) => item.type !== 'root' && item.parentId === currentFolderId,\n    ) as (PartialTreeFile | PartialTreeFolderNode)[]\n    const filtered =\n      searchString === '' ? inThisFolder : (\n        inThisFolder.filter(\n          (item) =>\n            (item.data.name ?? this.plugin.uppy.i18n('unnamed'))\n              .toLowerCase()\n              .indexOf(searchString.toLowerCase()) !== -1,\n        )\n      )\n\n    return filtered\n  }\n\n  validateAggregateRestrictions = (partialTree: PartialTree) => {\n    const checkedFiles = partialTree.filter(\n      (item) => item.type === 'file' && item.status === 'checked',\n    ) as PartialTreeFile[]\n    const uppyFiles = checkedFiles.map((file) => file.data)\n    return this.plugin.uppy.validateAggregateRestrictions(uppyFiles)\n  }\n\n  render(state: unknown, viewOptions: RenderOpts<M, B> = {}): h.JSX.Element {\n    const { didFirstRender } = this.plugin.getPluginState()\n    const { i18n } = this.plugin.uppy\n\n    if (!didFirstRender) {\n      this.plugin.setPluginState({ didFirstRender: true })\n      this.provider.fetchPreAuthToken()\n      this.openFolder(this.plugin.rootFolderId)\n    }\n\n    const opts: Opts<M, B> = { ...this.opts, ...viewOptions }\n    const { authenticated, loading } = this.plugin.getPluginState()\n    const pluginIcon = this.plugin.icon || defaultPickerIcon\n\n    if (authenticated === false) {\n      return (\n        <AuthView\n          pluginName={this.plugin.title}\n          pluginIcon={pluginIcon}\n          handleAuth={this.handleAuth}\n          i18n={this.plugin.uppy.i18nArray}\n          renderForm={opts.renderAuthForm}\n          loading={loading}\n        />\n      )\n    }\n\n    const { partialTree, currentFolderId, username, searchString } =\n      this.plugin.getPluginState()\n    const breadcrumbs = getBreadcrumbs(partialTree, currentFolderId)\n\n    return (\n      <div\n        className={classNames(\n          'uppy-ProviderBrowser',\n          `uppy-ProviderBrowser-viewType--${opts.viewType}`,\n        )}\n      >\n        <Header<M, B>\n          showBreadcrumbs={opts.showBreadcrumbs}\n          openFolder={this.openFolder}\n          breadcrumbs={breadcrumbs}\n          pluginIcon={pluginIcon}\n          title={this.plugin.title}\n          logout={this.logout}\n          username={username}\n          i18n={i18n}\n        />\n\n        {opts.showFilter && (\n          <SearchInput\n            searchString={searchString}\n            setSearchString={(s: string) => {\n              this.plugin.setPluginState({ searchString: s })\n            }}\n            submitSearchString={() => {}}\n            inputLabel={i18n('filter')}\n            clearSearchLabel={i18n('resetFilter')}\n            wrapperClassName=\"uppy-ProviderBrowser-searchFilter\"\n            inputClassName=\"uppy-ProviderBrowser-searchFilterInput\"\n          />\n        )}\n\n        <Browser<M, B>\n          toggleCheckbox={this.toggleCheckbox}\n          displayedPartialTree={this.getDisplayedPartialTree()}\n          openFolder={this.openFolder}\n          virtualList={opts.virtualList}\n          noResultsLabel={i18n('noFilesFound')}\n          handleScroll={this.handleScroll}\n          viewType={opts.viewType}\n          showTitles={opts.showTitles}\n          i18n={this.plugin.uppy.i18n}\n          isLoading={loading}\n        />\n\n        <FooterActions\n          partialTree={partialTree}\n          donePicking={this.donePicking}\n          cancelSelection={this.cancelSelection}\n          i18n={i18n}\n          validateAggregateRestrictions={this.validateAggregateRestrictions}\n        />\n      </div>\n    )\n  }\n}\n"],"mappings":"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","ignoreList":[]}