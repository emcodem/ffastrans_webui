{"version":3,"names":["h","useEffect","useState","useCallback","classNames","nanoid","getFileTypeIcon","ignoreEvent","FilePreview","RenderMetaFields","FileCard","props","_getMetaFields","files","fileCardFor","toggleFileCard","saveFileCard","metaFields","requiredMetaFields","openFileEditor","i18n","i18nArray","className","canEditFile","getMetaFields","file","computedMetaFields","showEditButton","storedMetaData","forEach","field","_file$meta$field$id","id","meta","formState","setFormState","handleSave","ev","preventDefault","updateMeta","newVal","name","handleCancel","form","formEl","document","createElement","setAttribute","body","appendChild","addEventListener","removeEventListener","removeChild","onDragOver","onDragLeave","onDrop","onPaste","role","type","title","onClick","style","backgroundColor","color","event"],"sources":["index.tsx"],"sourcesContent":["import { h } from 'preact'\nimport { useEffect, useState, useCallback } from 'preact/hooks'\nimport classNames from 'classnames'\nimport { nanoid } from 'nanoid/non-secure'\nimport getFileTypeIcon from '../../utils/getFileTypeIcon.tsx'\nimport ignoreEvent from '../../utils/ignoreEvent.ts'\nimport FilePreview from '../FilePreview.tsx'\nimport RenderMetaFields from './RenderMetaFields.tsx'\n\ntype $TSFixMe = any\n\nexport default function FileCard(props: $TSFixMe) {\n  const {\n    files,\n    fileCardFor,\n    toggleFileCard,\n    saveFileCard,\n    metaFields,\n    requiredMetaFields,\n    openFileEditor,\n    i18n,\n    i18nArray,\n    className,\n    canEditFile,\n  } = props\n\n  const getMetaFields = () => {\n    return typeof metaFields === 'function' ?\n        metaFields(files[fileCardFor])\n      : metaFields\n  }\n\n  const file = files[fileCardFor]\n  const computedMetaFields = getMetaFields() ?? []\n  const showEditButton = canEditFile(file)\n\n  const storedMetaData: Record<string, string> = {}\n  computedMetaFields.forEach((field: $TSFixMe) => {\n    storedMetaData[field.id] = file.meta[field.id] ?? ''\n  })\n\n  const [formState, setFormState] = useState(storedMetaData)\n\n  const handleSave = useCallback(\n    (ev: $TSFixMe) => {\n      ev.preventDefault()\n      saveFileCard(formState, fileCardFor)\n    },\n    [saveFileCard, formState, fileCardFor],\n  )\n\n  const updateMeta = (newVal: $TSFixMe, name: $TSFixMe) => {\n    setFormState({\n      ...formState,\n      [name]: newVal,\n    })\n  }\n\n  const handleCancel = () => {\n    toggleFileCard(false)\n  }\n\n  const [form] = useState(() => {\n    const formEl = document.createElement('form')\n    formEl.setAttribute('tabindex', '-1')\n    formEl.id = nanoid()\n    return formEl\n  })\n\n  useEffect(() => {\n    document.body.appendChild(form)\n    form.addEventListener('submit', handleSave)\n    return () => {\n      form.removeEventListener('submit', handleSave)\n      document.body.removeChild(form)\n    }\n  }, [form, handleSave])\n\n  return (\n    <div\n      className={classNames('uppy-Dashboard-FileCard', className)}\n      data-uppy-panelType=\"FileCard\"\n      onDragOver={ignoreEvent}\n      onDragLeave={ignoreEvent}\n      onDrop={ignoreEvent}\n      onPaste={ignoreEvent}\n    >\n      <div className=\"uppy-DashboardContent-bar\">\n        <div\n          className=\"uppy-DashboardContent-title\"\n          role=\"heading\"\n          aria-level=\"1\"\n        >\n          {i18nArray('editing', {\n            file: (\n              <span className=\"uppy-DashboardContent-titleFile\">\n                {file.meta ? file.meta.name : file.name}\n              </span>\n            ),\n          })}\n        </div>\n        <button\n          className=\"uppy-DashboardContent-back\"\n          type=\"button\"\n          form={form.id}\n          title={i18n('finishEditingFile')}\n          onClick={handleCancel}\n        >\n          {i18n('cancel')}\n        </button>\n      </div>\n\n      <div className=\"uppy-Dashboard-FileCard-inner\">\n        <div\n          className=\"uppy-Dashboard-FileCard-preview\"\n          style={{ backgroundColor: getFileTypeIcon(file.type).color }}\n        >\n          <FilePreview file={file} />\n          {showEditButton && (\n            <button\n              type=\"button\"\n              className=\"uppy-u-reset uppy-c-btn uppy-Dashboard-FileCard-edit\"\n              onClick={(event: $TSFixMe) => {\n                // When opening the image editor we want to save any meta fields changes.\n                // Otherwise it's confusing for the user to click save in the editor,\n                // but the changes here are discarded. This bypasses validation,\n                // but we are okay with that.\n                handleSave(event)\n                openFileEditor(file)\n              }}\n            >\n              {/* At the moment we only have one file editor - image editor.\n              If we get editors for other file formats (e.g. pdfs),\n              we can conditionally display i18n('editFile')/i18n('editImage'). */}\n              {i18n('editImage')}\n            </button>\n          )}\n        </div>\n\n        <div className=\"uppy-Dashboard-FileCard-info\">\n          <RenderMetaFields\n            computedMetaFields={computedMetaFields}\n            requiredMetaFields={requiredMetaFields}\n            updateMeta={updateMeta}\n            form={form}\n            formState={formState}\n          />\n        </div>\n\n        <div className=\"uppy-Dashboard-FileCard-actions\">\n          <button\n            className=\"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Dashboard-FileCard-actionsBtn\"\n            // If `form` attribute is supported, we want a submit button to trigger the form validation.\n            // Otherwise, fallback to a classic button with a onClick event handler.\n            type=\"submit\"\n            form={form.id}\n          >\n            {i18n('saveChanges')}\n          </button>\n          <button\n            className=\"uppy-u-reset uppy-c-btn uppy-c-btn-link uppy-Dashboard-FileCard-actionsBtn\"\n            type=\"button\"\n            onClick={handleCancel}\n            form={form.id}\n          >\n            {i18n('cancel')}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]}